Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-02-01T23:47:26+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/9d5958a75f5571a088b5f3c9894005fed84d98eb

Prepare for disappearance of CMFQuickInstaller.

Removed hard dependency on CMFQuickInstallerTool.
And marked the v52 module as non installable.

Files changed:
M CHANGES.rst
M plone/app/upgrade/__init__.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6e2a0dd3..e4710eb5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Removed hard dependency on ``CMFQuickInstallerTool``.
+  And marked the v52 module as non installable.  [maurits]
+
 - Import ``setupPasswordPolicyPlugin`` from canonical place in ``PlonePAS``.
   [maurits]
 
diff --git a/plone/app/upgrade/__init__.py b/plone/app/upgrade/__init__.py
index 7f87a09d..17320fea 100644
--- a/plone/app/upgrade/__init__.py
+++ b/plone/app/upgrade/__init__.py
@@ -1,7 +1,15 @@
 import pkg_resources
 import sys
 from zope.interface import implementer
-from Products.CMFQuickInstallerTool.interfaces import INonInstallable
+try:
+    # This is needed on Plone 5.0.
+    from Products.CMFQuickInstallerTool.interfaces import INonInstallable
+except ImportError:
+    # On Plone 5.1 we can use this.
+    # Note that the interface is available on earlier Plones,
+    # but not for the getNonInstallableProducts method.
+    # So we must use this as fallback.
+    from Products.CMFPlone.interfaces import INonInstallable
 from plone.app.upgrade.utils import alias_module
 import bbb
 import bbbd
@@ -19,6 +27,7 @@ def getNonInstallableProducts(self):
             'plone.app.upgrade.v43',
             'plone.app.upgrade.v50',
             'plone.app.upgrade.v51',
+            'plone.app.upgrade.v52',
         ]
 
 try:
diff --git a/setup.py b/setup.py
index 65864d98..a66c9d8f 100644
--- a/setup.py
+++ b/setup.py
@@ -51,7 +51,6 @@
         'Products.CMFPlone',
         'Products.CMFCore',
         'Products.CMFEditions',
-        'Products.CMFQuickInstallerTool',
         'Products.GenericSetup>=1.8.1',
         'Products.PlonePAS >= 5.0.1',
         'Products.PluggableAuthService',


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-02-02T01:12:48+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/f125efb70ba9e65dcc0ab676391050bca97ae311

Merge pull request #150 from plone/qi-conditional

Prepare for disappearance of CMFQuickInstaller.

Files changed:
M CHANGES.rst
M plone/app/upgrade/__init__.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6e2a0dd3..e4710eb5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,9 @@ New features:
 
 Bug fixes:
 
+- Removed hard dependency on ``CMFQuickInstallerTool``.
+  And marked the v52 module as non installable.  [maurits]
+
 - Import ``setupPasswordPolicyPlugin`` from canonical place in ``PlonePAS``.
   [maurits]
 
diff --git a/plone/app/upgrade/__init__.py b/plone/app/upgrade/__init__.py
index 7f87a09d..17320fea 100644
--- a/plone/app/upgrade/__init__.py
+++ b/plone/app/upgrade/__init__.py
@@ -1,7 +1,15 @@
 import pkg_resources
 import sys
 from zope.interface import implementer
-from Products.CMFQuickInstallerTool.interfaces import INonInstallable
+try:
+    # This is needed on Plone 5.0.
+    from Products.CMFQuickInstallerTool.interfaces import INonInstallable
+except ImportError:
+    # On Plone 5.1 we can use this.
+    # Note that the interface is available on earlier Plones,
+    # but not for the getNonInstallableProducts method.
+    # So we must use this as fallback.
+    from Products.CMFPlone.interfaces import INonInstallable
 from plone.app.upgrade.utils import alias_module
 import bbb
 import bbbd
@@ -19,6 +27,7 @@ def getNonInstallableProducts(self):
             'plone.app.upgrade.v43',
             'plone.app.upgrade.v50',
             'plone.app.upgrade.v51',
+            'plone.app.upgrade.v52',
         ]
 
 try:
diff --git a/setup.py b/setup.py
index 65864d98..a66c9d8f 100644
--- a/setup.py
+++ b/setup.py
@@ -51,7 +51,6 @@
         'Products.CMFPlone',
         'Products.CMFCore',
         'Products.CMFEditions',
-        'Products.CMFQuickInstallerTool',
         'Products.GenericSetup>=1.8.1',
         'Products.PlonePAS >= 5.0.1',
         'Products.PluggableAuthService',



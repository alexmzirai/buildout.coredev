Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-01-19T13:58:23+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/3401b8470188cb83cfcffec6a13cf4f8926d0a96

Fix sorting by last modified.

Fixes: https://github.com/plone/Products.CMFPlone/issues/2199

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d50b847..e2a9249 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,7 +17,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fix sorting by last modified.
+  Fixes: https://github.com/plone/Products.CMFPlone/issues/2199
+  [ale-rt]
 
 
 3.4.5 (2017-11-24)
diff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py
index 05e8376..8ec2c58 100644
--- a/plone/app/content/browser/contents/__init__.py
+++ b/plone/app/content/browser/contents/__init__.py
@@ -196,14 +196,14 @@ def ignored_columns(self):
     def get_columns(self):
         # Base set of columns
         columns = {
-            'CreationDate': translate(_('Created on'), context=self.request),  # noqa
+            'CreationDate': translate(_('Created on'), context=self.request),
             'Creator': translate(_('Creator'), context=self.request),
             'Description': translate(_('Description'), context=self.request),
             'EffectiveDate': translate(_('Publication date'), context=self.request),  # noqa
             'end': translate(_('End Date'), context=self.request),
             'exclude_from_nav': translate(_('Excluded from navigation'), context=self.request),  # noqa
             'ExpirationDate': translate(_('Expiration date'), context=self.request),  # noqa
-            'getObjSize': translate(_('Object Size'), context=self.request),  # noqa
+            'getObjSize': translate(_('Object Size'), context=self.request),
             'id': translate(_('ID'), context=self.request),
             'is_folderish': translate(_('Folder'), context=self.request),
             'last_comment_date': translate(_('Last comment date'), context=self.request),  # noqa
@@ -254,7 +254,6 @@ def ignored_indexes(self):
             'getRawRelatedItems',
             'in_reply_to',
             'meta_type',
-            'modified',
             'object_provides',
             'portal_type',
             'SearchableText',
@@ -272,7 +271,7 @@ def get_indexes(self):
             'expires': translate(_('Expiration date'), context=self.request),
             'id': translate(_('ID'), context=self.request),
             'is_folderish': translate(_('Folder'), context=self.request),
-            'ModificationDate': translate(_('Last modified'), context=self.request),  # noqa
+            'modified': translate(_('Last modified'), context=self.request),  # noqa
             'review_state': translate(_('Review state'), context=self.request),
             'sortable_title': translate(_('Title'), context=self.request),
             'start': translate(_('Start Date'), context=self.request),


Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-01-25T12:38:49+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/55f3ed8503c370ff4c4e3252a828dbd592b65cd3

Merge branch 'master' into fix-sorting-by-last-modified

Files changed:
M CHANGES.rst
M plone/app/content/browser/i18n.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e2a9249..2dfc9b7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,6 +21,9 @@ Bug fixes:
   Fixes: https://github.com/plone/Products.CMFPlone/issues/2199
   [ale-rt]
 
+- Added support for multiple po file on same i18n domain for plonejsi18n view.
+  [mamico]
+
 
 3.4.5 (2017-11-24)
 ------------------
diff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py
index 832c535..c2c5394 100644
--- a/plone/app/content/browser/i18n.py
+++ b/plone/app/content/browser/i18n.py
@@ -23,12 +23,14 @@ def _gettext_catalog(self, domain, language):
                 return
             else:
                 language = baselanguage
-        mo_path = td._catalogs[language][0]
-        catalog = td._data[mo_path]._catalog
-        if catalog is None:
-            td._data[mo_path].reload()
+        _catalog = {}
+        for mo_path in td._catalogs[language]:
             catalog = td._data[mo_path]._catalog
-        return catalog._catalog
+            if catalog is None:
+                td._data[mo_path].reload()
+                catalog = td._data[mo_path]._catalog
+            _catalog.update(catalog._catalog)
+        return _catalog
 
     def __call__(self, domain=None, language=None):
 


Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-01-25T12:38:57+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/da510facff1958dadcb62b4c80b85a11f413d6ef

Merge pull request #149 from plone/fix-sorting-by-last-modified

Fix sorting by last modified

Files changed:
M CHANGES.rst
M plone/app/content/browser/contents/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 30110d8..2dfc9b7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,10 @@ New features:
 
 Bug fixes:
 
+- Fix sorting by last modified.
+  Fixes: https://github.com/plone/Products.CMFPlone/issues/2199
+  [ale-rt]
+
 - Added support for multiple po file on same i18n domain for plonejsi18n view.
   [mamico]
 
diff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py
index 05e8376..8ec2c58 100644
--- a/plone/app/content/browser/contents/__init__.py
+++ b/plone/app/content/browser/contents/__init__.py
@@ -196,14 +196,14 @@ def ignored_columns(self):
     def get_columns(self):
         # Base set of columns
         columns = {
-            'CreationDate': translate(_('Created on'), context=self.request),  # noqa
+            'CreationDate': translate(_('Created on'), context=self.request),
             'Creator': translate(_('Creator'), context=self.request),
             'Description': translate(_('Description'), context=self.request),
             'EffectiveDate': translate(_('Publication date'), context=self.request),  # noqa
             'end': translate(_('End Date'), context=self.request),
             'exclude_from_nav': translate(_('Excluded from navigation'), context=self.request),  # noqa
             'ExpirationDate': translate(_('Expiration date'), context=self.request),  # noqa
-            'getObjSize': translate(_('Object Size'), context=self.request),  # noqa
+            'getObjSize': translate(_('Object Size'), context=self.request),
             'id': translate(_('ID'), context=self.request),
             'is_folderish': translate(_('Folder'), context=self.request),
             'last_comment_date': translate(_('Last comment date'), context=self.request),  # noqa
@@ -254,7 +254,6 @@ def ignored_indexes(self):
             'getRawRelatedItems',
             'in_reply_to',
             'meta_type',
-            'modified',
             'object_provides',
             'portal_type',
             'SearchableText',
@@ -272,7 +271,7 @@ def get_indexes(self):
             'expires': translate(_('Expiration date'), context=self.request),
             'id': translate(_('ID'), context=self.request),
             'is_folderish': translate(_('Folder'), context=self.request),
-            'ModificationDate': translate(_('Last modified'), context=self.request),  # noqa
+            'modified': translate(_('Last modified'), context=self.request),  # noqa
             'review_state': translate(_('Review state'), context=self.request),
             'sortable_title': translate(_('Title'), context=self.request),
             'start': translate(_('Start Date'), context=self.request),



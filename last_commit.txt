Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-01-27T12:22:09+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e531d623bbfcd23b997fc885efabeac062736ca3

Fixed linkintegrityrobot tests.

In the widget we need to go one level up before we can find the document to search for.

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

diff --git a/CHANGES.rst b/CHANGES.rst
index d05b9f813..ede623463 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -19,7 +19,7 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fixed linkintegrity robot tests.  [maurits]
 
 
 5.1rc2 (2017-11-26)
diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot
index 6b6b6090d..38f916f68 100644
--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot
+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot
@@ -25,8 +25,6 @@ Test Teardown  Run keywords  Plone Test Teardown
 *** Test Cases ***************************************************************
 
 Scenario: When page is linked show warning
-  [Tags]  unstable
-  [Documentation]  This sometimes fails with: StaleElementReferenceException: Message: Element not found in the cache.
   Given a logged-in site administrator
     and a page to link to
     and a page to edit
@@ -35,8 +33,6 @@ Scenario: When page is linked show warning
 
 
 Scenario: After you fix linked page no longer show warning
-  [Tags]  unstable
-  [Documentation]  This sometimes fails with: StaleElementReferenceException: Message: Element not found in the cache.
   Given a logged-in site administrator
   a page to link to
     and a page to edit
@@ -47,9 +43,6 @@ Scenario: After you fix linked page no longer show warning
 
 
 Scenario: Show warning when deleting linked item from folder_contents
-  [Tags]  unstable
-  [Documentation]  This sometimes fails with: StaleElementReferenceException: Message: Element not found in the cache.
-  ...              This one seems to fail more often than the others.
   Given a logged-in site administrator
   a page to link to
     and a page to edit
@@ -86,6 +79,8 @@ a link in rich text
   Given patterns are loaded
   Wait until element is visible  css=.pat-relateditems .select2-input.select2-default
   Click Element  css=.pat-relateditems .select2-input.select2-default
+  Wait until element is visible  xpath=(//span[contains(., 'One level up')])
+  Click Element  xpath=(//span[contains(., 'One level up')])
   Wait until element is visible  xpath=(//span[contains(., 'Foo')])
   Click Element  xpath=(//span[contains(., 'Foo')])
   Wait until page contains  Foo


Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-01-27T13:21:38+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/8a7587c87f5e54bad13755d0c41aa5afd7ec5228

Merge branch '5.1.x' into linkintegrity-robot-tests-fix-51

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/robot/test_controlpanel_actions.robot
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ede623463..f3bf40455 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -21,6 +21,19 @@ Bug fixes:
 
 - Fixed linkintegrity robot tests.  [maurits]
 
+- Fixed flaky actions controlpanel tests by waiting longer.  [maurits]
+
+- Require AccessControl 3.0.14 so ``guarded_getitem`` is used.
+  Part of PloneHotfix20171128.  [maurits]
+
+- Improved isURLInPortal according to PloneHotfix20171128.
+  Accept only http/https, and doubly check escaped urls.  [maurits]
+
+- Fixed Products.CMFPlacefulWorkflow being marked as not installed after upgrade from 4.3.
+  This is true for any package in the Products namespace that was installed.
+  Fixes `issue 2103 <https://github.com/plone/Products.CMFPlone/issues/2103>`_.
+  [maurits]
+
 
 5.1rc2 (2017-11-26)
 -------------------
@@ -35,17 +48,7 @@ New features:
 
 Bug fixes:
 
-- Require AccessControl 3.0.14 so ``guarded_getitem`` is used.
-  Part of PloneHotfix20171128.  [maurits]
-
 - Show example for expression in actions control panel.
-
-- Improved isURLInPortal according to PloneHotfix20171128.
-  Accept only http/https, and doubly check escaped urls.  [maurits]
-
-- Fixed Products.CMFPlacefulWorkflow being marked as not installed after upgrade from 4.3.
-  This is true for any package in the Products namespace that was installed.
-  Fixes `issue 2103 <https://github.com/plone/Products.CMFPlone/issues/2103>`_.
   [maurits]
 
 - Fixed add-on listed as uninstalled when the default profile is not the first alphabetically.
diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_actions.robot b/Products/CMFPlone/tests/robot/test_controlpanel_actions.robot
index d6a8157e9..1cd2e5f3f 100644
--- a/Products/CMFPlone/tests/robot/test_controlpanel_actions.robot
+++ b/Products/CMFPlone/tests/robot/test_controlpanel_actions.robot
@@ -18,34 +18,40 @@ Scenario: Modify an existing action in Actions Control Panel
   Given a logged-in administrator
     and the actions control panel
    When I modify an action title
+   Sleep  1
    Then anonymous users can see the new action title
 
 Scenario: Reorder in Actions Control Panel
   Given a logged-in administrator
     and the actions control panel
    When I change the actions order
+   Sleep  1
    Then anonymous users can see the actions new ordering
 
 Scenario: Create a new action in Actions Control Panel
   Given a logged-in administrator
     and the actions control panel
    When I add a new action
+   Sleep  1
    Then logged-in users can see the new action
 
 Scenario: Hide/show an action in Actions Control Panel
   Given a logged-in administrator
     and the actions control panel
    When I hide an action
+   Sleep  1
    Then anonymous users cannot see the action anymore
   Given a logged-in administrator
     and the actions control panel
    When I unhide the action
+   Sleep  1
    Then anonymous users can see the action again
 
 Scenario: Delete an action in Actions Control Panel
   Given a logged-in administrator
     and the actions control panel
    When I delete an action
+   Sleep  1
    Then anonymous users cannot see the action anymore
 
 *** Keywords *****************************************************************
diff --git a/setup.py b/setup.py
index 11ecace3a..a9309ba82 100644
--- a/setup.py
+++ b/setup.py
@@ -72,7 +72,7 @@
         'Products.contentmigration',
         'Products.statusmessages',
         'ZODB3',
-        'Zope2 >= 2.13.0',
+        'Zope2 > 2.13.0',
         'borg.localrole',
         'five.customerize',
         'five.localsitemanager',


Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-01-27T13:22:00+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/0275a03830897644ce811764d83a839345256bba

Merge pull request #2275 from plone/linkintegrity-robot-tests-fix-51

Fixed linkintegrityrobot tests. [5.1]

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

diff --git a/CHANGES.rst b/CHANGES.rst
index 6e8def632..f3bf40455 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -19,6 +19,8 @@ New features:
 
 Bug fixes:
 
+- Fixed linkintegrity robot tests.  [maurits]
+
 - Fixed flaky actions controlpanel tests by waiting longer.  [maurits]
 
 - Require AccessControl 3.0.14 so ``guarded_getitem`` is used.
diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot
index 6b6b6090d..38f916f68 100644
--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot
+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot
@@ -25,8 +25,6 @@ Test Teardown  Run keywords  Plone Test Teardown
 *** Test Cases ***************************************************************
 
 Scenario: When page is linked show warning
-  [Tags]  unstable
-  [Documentation]  This sometimes fails with: StaleElementReferenceException: Message: Element not found in the cache.
   Given a logged-in site administrator
     and a page to link to
     and a page to edit
@@ -35,8 +33,6 @@ Scenario: When page is linked show warning
 
 
 Scenario: After you fix linked page no longer show warning
-  [Tags]  unstable
-  [Documentation]  This sometimes fails with: StaleElementReferenceException: Message: Element not found in the cache.
   Given a logged-in site administrator
   a page to link to
     and a page to edit
@@ -47,9 +43,6 @@ Scenario: After you fix linked page no longer show warning
 
 
 Scenario: Show warning when deleting linked item from folder_contents
-  [Tags]  unstable
-  [Documentation]  This sometimes fails with: StaleElementReferenceException: Message: Element not found in the cache.
-  ...              This one seems to fail more often than the others.
   Given a logged-in site administrator
   a page to link to
     and a page to edit
@@ -86,6 +79,8 @@ a link in rich text
   Given patterns are loaded
   Wait until element is visible  css=.pat-relateditems .select2-input.select2-default
   Click Element  css=.pat-relateditems .select2-input.select2-default
+  Wait until element is visible  xpath=(//span[contains(., 'One level up')])
+  Click Element  xpath=(//span[contains(., 'One level up')])
   Wait until element is visible  xpath=(//span[contains(., 'Foo')])
   Click Element  xpath=(//span[contains(., 'Foo')])
   Wait until page contains  Foo



Repository: plone.protect


Branch: refs/heads/master
Date: 2018-01-25T18:44:22+01:00
Author: Max Jakob (vincero) <max.jakob@ifi.lmu.de>
Commit: https://github.com/plone/plone.protect/commit/6c1c886bd5cc727dd789990ecd3481d6aa0d98be

Add Python 2 / 3 compatibilityJ

Files changed:
M CHANGES.rst
M plone/protect/authenticator.py
M plone/protect/auto.py
M plone/protect/tests/testAuto.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cffa53c..81595da 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ Bug fixes:
   (Fixes https://github.com/plone/plone.protect/issues/15)
   [fRiSi]
 
+- Add Python 2 / 3 compatibility
+  [vincero]
+
 
 3.1.1 (2017-08-27)
 ------------------
diff --git a/plone/protect/authenticator.py b/plone/protect/authenticator.py
index e7e9d9d..34caae4 100644
--- a/plone/protect/authenticator.py
+++ b/plone/protect/authenticator.py
@@ -9,6 +9,7 @@
 from ZPublisher.HTTPRequest import HTTPRequest
 
 import hmac
+import six
 
 
 try:
@@ -35,7 +36,7 @@ def _is_equal(val1, val2):
     """
     constant time comparison
     """
-    if not isinstance(val1, basestring) or not isinstance(val2, basestring):
+    if not isinstance(val1, six.string_types) or not isinstance(val2, six.string_types):
         return False
     if len(val1) != len(val2):
         return False
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index f1bd0f9..2595eaf 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -19,8 +19,8 @@
 from Products.CMFCore.utils import getToolByName
 from repoze.xmliter.serializer import XMLSerializer
 from repoze.xmliter.utils import getHTMLSerializer
-from urllib import urlencode
-from urlparse import urlparse
+from six.moves.urllib.parse import urlencode
+from six.moves.urllib.parse import urlparse
 from zExceptions import Forbidden
 from zope.component import adapts
 from zope.component import ComponentLookupError
@@ -32,6 +32,7 @@
 import logging
 import os
 import pkg_resources
+import six
 import traceback
 import transaction
 import types
@@ -125,7 +126,7 @@ def parseTree(self, result, encoding):
             return None
 
     def transformBytes(self, result, encoding):
-        result = unicode(result, encoding, 'ignore')
+        result = six.text_type(result, encoding, 'ignore')
         return self.transformIterable([result], encoding)
 
     def transformString(self, result, encoding):
diff --git a/plone/protect/tests/testAuto.py b/plone/protect/tests/testAuto.py
index 6ae1252..097c32c 100644
--- a/plone/protect/tests/testAuto.py
+++ b/plone/protect/tests/testAuto.py
@@ -81,7 +81,7 @@ def test_forbidden_raised_if_auth_failure(self):
         # XXX: plone.transformchain don't reraise exceptions
         # try:
         #    self.browser.getControl('submit1').click()
-        # except Exception, ex:
+        # except Exception as ex:
         #     self.assertEquals(ex.getcode(), 403)
         self.browser.getControl('submit1').click()
         self.assertFalse(hasattr(self.portal, "foo"))
diff --git a/setup.py b/setup.py
index b787a88..05fdafe 100644
--- a/setup.py
+++ b/setup.py
@@ -38,6 +38,7 @@
     install_requires=[
         'setuptools',
         'plone.keyring >= 3.0dev',
+        'six',
         'zope.component',
         'zope.interface',
         'Zope2',


Repository: plone.protect


Branch: refs/heads/master
Date: 2018-01-27T01:17:55+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.protect/commit/6e05fb91c31d3d176df13fc1ebab31f6099036de

Merge pull request #70 from plone/python3

Add Python 2 / 3 compatibilityJ

Files changed:
M CHANGES.rst
M plone/protect/authenticator.py
M plone/protect/auto.py
M plone/protect/tests/testAuto.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cffa53c..81595da 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ Bug fixes:
   (Fixes https://github.com/plone/plone.protect/issues/15)
   [fRiSi]
 
+- Add Python 2 / 3 compatibility
+  [vincero]
+
 
 3.1.1 (2017-08-27)
 ------------------
diff --git a/plone/protect/authenticator.py b/plone/protect/authenticator.py
index e7e9d9d..34caae4 100644
--- a/plone/protect/authenticator.py
+++ b/plone/protect/authenticator.py
@@ -9,6 +9,7 @@
 from ZPublisher.HTTPRequest import HTTPRequest
 
 import hmac
+import six
 
 
 try:
@@ -35,7 +36,7 @@ def _is_equal(val1, val2):
     """
     constant time comparison
     """
-    if not isinstance(val1, basestring) or not isinstance(val2, basestring):
+    if not isinstance(val1, six.string_types) or not isinstance(val2, six.string_types):
         return False
     if len(val1) != len(val2):
         return False
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index f1bd0f9..2595eaf 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -19,8 +19,8 @@
 from Products.CMFCore.utils import getToolByName
 from repoze.xmliter.serializer import XMLSerializer
 from repoze.xmliter.utils import getHTMLSerializer
-from urllib import urlencode
-from urlparse import urlparse
+from six.moves.urllib.parse import urlencode
+from six.moves.urllib.parse import urlparse
 from zExceptions import Forbidden
 from zope.component import adapts
 from zope.component import ComponentLookupError
@@ -32,6 +32,7 @@
 import logging
 import os
 import pkg_resources
+import six
 import traceback
 import transaction
 import types
@@ -125,7 +126,7 @@ def parseTree(self, result, encoding):
             return None
 
     def transformBytes(self, result, encoding):
-        result = unicode(result, encoding, 'ignore')
+        result = six.text_type(result, encoding, 'ignore')
         return self.transformIterable([result], encoding)
 
     def transformString(self, result, encoding):
diff --git a/plone/protect/tests/testAuto.py b/plone/protect/tests/testAuto.py
index 6ae1252..097c32c 100644
--- a/plone/protect/tests/testAuto.py
+++ b/plone/protect/tests/testAuto.py
@@ -81,7 +81,7 @@ def test_forbidden_raised_if_auth_failure(self):
         # XXX: plone.transformchain don't reraise exceptions
         # try:
         #    self.browser.getControl('submit1').click()
-        # except Exception, ex:
+        # except Exception as ex:
         #     self.assertEquals(ex.getcode(), 403)
         self.browser.getControl('submit1').click()
         self.assertFalse(hasattr(self.portal, "foo"))
diff --git a/setup.py b/setup.py
index b787a88..05fdafe 100644
--- a/setup.py
+++ b/setup.py
@@ -38,6 +38,7 @@
     install_requires=[
         'setuptools',
         'plone.keyring >= 3.0dev',
+        'six',
         'zope.component',
         'zope.interface',
         'Zope2',



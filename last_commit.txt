Repository: plone.versioncheck


Branch: refs/heads/master
Date: 2018-01-25T18:19:28+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.versioncheck/commit/c7ac60a5a6b5e019392db413d55017d05f88ed7c

Relative extends in urls were broken

Files changed:
M CHANGES.rst
M src/plone/versioncheck/parser.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cf9dc92..031250a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Fixed: Relative extends in urls were broken.
+  [jensens]
 
 
 1.6.5 (2017-07-03)
diff --git a/src/plone/versioncheck/parser.py b/src/plone/versioncheck/parser.py
index ebe77eb..c498826 100644
--- a/src/plone/versioncheck/parser.py
+++ b/src/plone/versioncheck/parser.py
@@ -48,12 +48,17 @@ def _extract_versions_section(  # NOQA: C901
     if annotations is None:
         annotations = OrderedDict()
     if '://' not in filename:
-        if relative:
-            if filename.startswith(relative + '/'):
-                filename = filename[len(relative + '/'):]
-            filename = os.path.join(base_dir, relative, filename)
+        if relative and '://' in relative:
+            # relative to url!
+            filename = '{0}/{1}'.format(relative, filename)
         else:
-            filename = os.path.join(base_dir, filename)
+            if relative:
+                if filename.startswith(relative + '/'):
+                    filename = filename[len(relative + '/'):]
+                filename = os.path.join(base_dir, relative, filename)
+            else:
+                filename = os.path.join(base_dir, filename)
+
     sys.stderr.write('\n- {0}'.format(filename))
 
     try:
@@ -61,7 +66,6 @@ def _extract_versions_section(  # NOQA: C901
             buildout = Buildout(filename, [])  # Use zc.buildout parser
     except UserError:
         buildout = {'buildout': {}}
-
     config = ConfigParser()
     if os.path.isfile(filename):
         config.read(filename)



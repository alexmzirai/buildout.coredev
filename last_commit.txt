Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-02-03T01:35:15+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/c47a1ffe548e98d6d64ca42c099e89a5063d3429

[tests] Remove test_suite

Test runners are clever enough to find the tests.

Files changed:
M plone/autoform/tests/test_directives.py
M plone/autoform/tests/test_supermodel_handler.py

diff --git a/plone/autoform/tests/test_directives.py b/plone/autoform/tests/test_directives.py
index 027bf75..db2df1d 100644
--- a/plone/autoform/tests/test_directives.py
+++ b/plone/autoform/tests/test_directives.py
@@ -208,9 +208,3 @@ class IBar(IFoo):
             [('foo', 'after', 'bar'), ],
             IBar.queryTaggedValue(ORDER_KEY)
         )
-
-
-def test_suite():
-    return unittest.TestSuite((
-        unittest.makeSuite(TestSchemaDirectives),
-    ))
diff --git a/plone/autoform/tests/test_supermodel_handler.py b/plone/autoform/tests/test_supermodel_handler.py
index 90e699e..0044458 100644
--- a/plone/autoform/tests/test_supermodel_handler.py
+++ b/plone/autoform/tests/test_supermodel_handler.py
@@ -509,10 +509,3 @@ class IDummy(Interface):
             None,
             field_node.get(ns('write-permission', self.namespace))
         )
-
-
-def test_suite():
-    suite = unittest.TestSuite()
-    suite.addTest(unittest.makeSuite(TestFormSchema))
-    suite.addTest(unittest.makeSuite(TestSecuritySchema))
-    return suite


Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-02-03T01:35:49+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/6a9eaec0fba81663f24f22c64df71d9b6edec88f

[cleanup] Remove code redundancy

Files changed:
M plone/autoform/testing.py
M plone/autoform/tests/test_doctests.py

diff --git a/plone/autoform/testing.py b/plone/autoform/testing.py
index ea77275..bd5b24a 100644
--- a/plone/autoform/testing.py
+++ b/plone/autoform/testing.py
@@ -2,6 +2,7 @@
 from plone.testing import z2
 from plone.testing import zca
 
+import doctest
 import plone.autoform
 
 
@@ -14,3 +15,8 @@
 AUTOFORM_INTEGRATION_TESTING = z2.IntegrationTesting(
     bases=(AUTOFORM_FIXTURE,),
     name='plone.autoform:Integration')
+
+optionflags = (
+    doctest.NORMALIZE_WHITESPACE
+    | doctest.ELLIPSIS
+)
diff --git a/plone/autoform/tests/test_doctests.py b/plone/autoform/tests/test_doctests.py
index 9c27acb..271d8a4 100644
--- a/plone/autoform/tests/test_doctests.py
+++ b/plone/autoform/tests/test_doctests.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from plone.autoform.testing import optionflags
 from plone.testing import layered
 from plone.testing.zca import UNIT_TESTING
 
@@ -6,26 +7,24 @@
 import unittest
 
 
+test_files = [
+    '../autoform.rst',
+    'subform.txt',
+    '../view.txt',
+    '../supermodel.txt',
+]
+
+
 def test_suite():
-    return unittest.TestSuite((
+    tests = [
         layered(
             doctest.DocFileSuite(
-                '../autoform.rst',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-        layered(
-            doctest.DocFileSuite(
-                'subform.txt',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-        layered(
-            doctest.DocFileSuite(
-                '../view.txt',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-        layered(
-            doctest.DocFileSuite(
-                '../supermodel.txt',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-    ))
+                test_file,
+                optionflags=optionflags,
+            ),
+            layer=UNIT_TESTING,
+        )
+        for test_file in test_files
+    ]
+
+    return unittest.TestSuite(tests)


Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-02-03T01:37:16+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/7105ad2e9305d6924cdc25255086f394030938a6

[testing] Remove unneeded tearDown

Files changed:
M plone/autoform/tests/test_utils.py

diff --git a/plone/autoform/tests/test_utils.py b/plone/autoform/tests/test_utils.py
index 7f5bf2a..5121e24 100644
--- a/plone/autoform/tests/test_utils.py
+++ b/plone/autoform/tests/test_utils.py
@@ -41,9 +41,6 @@ def checkPermission(self, perm, context):
         self.secman = DummySecurityManager()
         setSecurityManager(self.secman)
 
-    def tearDown(self):
-        noSecurityManager()
-
     def test_processFields_permissionChecks_no_prefix(self):
         form = Form(None, None)
         form.groups = ()
@@ -95,7 +92,7 @@ class subschema(schema):
         self.assertEqual([g.__name__ for g in form.groups], ['custom'])
 
     def test_fieldset_configuration(self):
-        """Test, if fieldsets can be orderd via fieldset configuration on a 
+        """Test, if fieldsets can be orderd via fieldset configuration on a
         schema without fields. This schema should also not be included in form
         groups.
         """
@@ -120,7 +117,7 @@ class schema3(Interface):
         fs3 = Fieldset('fs1', order=2)
         fs4 = Fieldset('fs2', order=1)
         schema3.setTaggedValue(FIELDSETS_KEY, [fs3, fs4])
-       
+
         processFields(form, schema1, prefix='prefix', permissionChecks=True)
         processFields(form, schema2, prefix='prefix', permissionChecks=True)
         processFields(form, schema3, prefix='prefix', permissionChecks=True)


Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-02-03T01:38:19+01:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/0c7877731abb592fa61013ed7765b161f7dd6d41

Update CHANGES

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index b70b02b..d9974c8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,8 @@ Bug fixes:
 - Prepare for Python 2 / 3 compatibility
   [pbauer]
 
+- Minor fixes on testing that could avoid having test isolation problems.
+  [gforcada]
 
 1.7.4 (2017-11-24)
 ------------------


Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-02-03T06:50:05+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/fc031b0e8ee7f9b82b952eff375230eebdc835d6

Merge pull request #32 from plone/gforcada-tests-improvements

Tests improvements

Files changed:
M CHANGES.rst
M plone/autoform/testing.py
M plone/autoform/tests/test_directives.py
M plone/autoform/tests/test_doctests.py
M plone/autoform/tests/test_supermodel_handler.py
M plone/autoform/tests/test_utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b70b02b..d9974c8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,8 @@ Bug fixes:
 - Prepare for Python 2 / 3 compatibility
   [pbauer]
 
+- Minor fixes on testing that could avoid having test isolation problems.
+  [gforcada]
 
 1.7.4 (2017-11-24)
 ------------------
diff --git a/plone/autoform/testing.py b/plone/autoform/testing.py
index ea77275..bd5b24a 100644
--- a/plone/autoform/testing.py
+++ b/plone/autoform/testing.py
@@ -2,6 +2,7 @@
 from plone.testing import z2
 from plone.testing import zca
 
+import doctest
 import plone.autoform
 
 
@@ -14,3 +15,8 @@
 AUTOFORM_INTEGRATION_TESTING = z2.IntegrationTesting(
     bases=(AUTOFORM_FIXTURE,),
     name='plone.autoform:Integration')
+
+optionflags = (
+    doctest.NORMALIZE_WHITESPACE
+    | doctest.ELLIPSIS
+)
diff --git a/plone/autoform/tests/test_directives.py b/plone/autoform/tests/test_directives.py
index 027bf75..db2df1d 100644
--- a/plone/autoform/tests/test_directives.py
+++ b/plone/autoform/tests/test_directives.py
@@ -208,9 +208,3 @@ class IBar(IFoo):
             [('foo', 'after', 'bar'), ],
             IBar.queryTaggedValue(ORDER_KEY)
         )
-
-
-def test_suite():
-    return unittest.TestSuite((
-        unittest.makeSuite(TestSchemaDirectives),
-    ))
diff --git a/plone/autoform/tests/test_doctests.py b/plone/autoform/tests/test_doctests.py
index 9c27acb..271d8a4 100644
--- a/plone/autoform/tests/test_doctests.py
+++ b/plone/autoform/tests/test_doctests.py
@@ -1,4 +1,5 @@
 # -*- coding: utf-8 -*-
+from plone.autoform.testing import optionflags
 from plone.testing import layered
 from plone.testing.zca import UNIT_TESTING
 
@@ -6,26 +7,24 @@
 import unittest
 
 
+test_files = [
+    '../autoform.rst',
+    'subform.txt',
+    '../view.txt',
+    '../supermodel.txt',
+]
+
+
 def test_suite():
-    return unittest.TestSuite((
+    tests = [
         layered(
             doctest.DocFileSuite(
-                '../autoform.rst',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-        layered(
-            doctest.DocFileSuite(
-                'subform.txt',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-        layered(
-            doctest.DocFileSuite(
-                '../view.txt',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-        layered(
-            doctest.DocFileSuite(
-                '../supermodel.txt',
-                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,),
-            layer=UNIT_TESTING),
-    ))
+                test_file,
+                optionflags=optionflags,
+            ),
+            layer=UNIT_TESTING,
+        )
+        for test_file in test_files
+    ]
+
+    return unittest.TestSuite(tests)
diff --git a/plone/autoform/tests/test_supermodel_handler.py b/plone/autoform/tests/test_supermodel_handler.py
index 90e699e..0044458 100644
--- a/plone/autoform/tests/test_supermodel_handler.py
+++ b/plone/autoform/tests/test_supermodel_handler.py
@@ -509,10 +509,3 @@ class IDummy(Interface):
             None,
             field_node.get(ns('write-permission', self.namespace))
         )
-
-
-def test_suite():
-    suite = unittest.TestSuite()
-    suite.addTest(unittest.makeSuite(TestFormSchema))
-    suite.addTest(unittest.makeSuite(TestSecuritySchema))
-    return suite
diff --git a/plone/autoform/tests/test_utils.py b/plone/autoform/tests/test_utils.py
index 7f5bf2a..5121e24 100644
--- a/plone/autoform/tests/test_utils.py
+++ b/plone/autoform/tests/test_utils.py
@@ -41,9 +41,6 @@ def checkPermission(self, perm, context):
         self.secman = DummySecurityManager()
         setSecurityManager(self.secman)
 
-    def tearDown(self):
-        noSecurityManager()
-
     def test_processFields_permissionChecks_no_prefix(self):
         form = Form(None, None)
         form.groups = ()
@@ -95,7 +92,7 @@ class subschema(schema):
         self.assertEqual([g.__name__ for g in form.groups], ['custom'])
 
     def test_fieldset_configuration(self):
-        """Test, if fieldsets can be orderd via fieldset configuration on a 
+        """Test, if fieldsets can be orderd via fieldset configuration on a
         schema without fields. This schema should also not be included in form
         groups.
         """
@@ -120,7 +117,7 @@ class schema3(Interface):
         fs3 = Fieldset('fs1', order=2)
         fs4 = Fieldset('fs2', order=1)
         schema3.setTaggedValue(FIELDSETS_KEY, [fs3, fs4])
-       
+
         processFields(form, schema1, prefix='prefix', permissionChecks=True)
         processFields(form, schema2, prefix='prefix', permissionChecks=True)
         processFields(form, schema3, prefix='prefix', permissionChecks=True)



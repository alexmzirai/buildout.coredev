Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-01-21T15:50:27+01:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/57a729682a5337065ead6eb154fd86948eddfcee

Added support for multiple po file on same i18n domain for plonejsi18n view.

Files changed:
M CHANGES.rst
M plone/app/content/browser/i18n.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d50b847..30110d8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,7 +17,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Added support for multiple po file on same i18n domain for plonejsi18n view.
+  [mamico]
 
 
 3.4.5 (2017-11-24)
diff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py
index 832c535..c2c5394 100644
--- a/plone/app/content/browser/i18n.py
+++ b/plone/app/content/browser/i18n.py
@@ -23,12 +23,14 @@ def _gettext_catalog(self, domain, language):
                 return
             else:
                 language = baselanguage
-        mo_path = td._catalogs[language][0]
-        catalog = td._data[mo_path]._catalog
-        if catalog is None:
-            td._data[mo_path].reload()
+        _catalog = {}
+        for mo_path in td._catalogs[language]:
             catalog = td._data[mo_path]._catalog
-        return catalog._catalog
+            if catalog is None:
+                td._data[mo_path].reload()
+                catalog = td._data[mo_path]._catalog
+            _catalog.update(catalog._catalog)
+        return _catalog
 
     def __call__(self, domain=None, language=None):
 


Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-01-25T12:38:00+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/adcb5eaacaaac6f1436afe92c3b7706320e6038d

Merge pull request #150 from mamico/master

Added support for multiple po file on same i18n domain for plonejsi18n view.

Files changed:
M CHANGES.rst
M plone/app/content/browser/i18n.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d50b847..30110d8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,7 +17,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Added support for multiple po file on same i18n domain for plonejsi18n view.
+  [mamico]
 
 
 3.4.5 (2017-11-24)
diff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py
index 832c535..c2c5394 100644
--- a/plone/app/content/browser/i18n.py
+++ b/plone/app/content/browser/i18n.py
@@ -23,12 +23,14 @@ def _gettext_catalog(self, domain, language):
                 return
             else:
                 language = baselanguage
-        mo_path = td._catalogs[language][0]
-        catalog = td._data[mo_path]._catalog
-        if catalog is None:
-            td._data[mo_path].reload()
+        _catalog = {}
+        for mo_path in td._catalogs[language]:
             catalog = td._data[mo_path]._catalog
-        return catalog._catalog
+            if catalog is None:
+                td._data[mo_path].reload()
+                catalog = td._data[mo_path]._catalog
+            _catalog.update(catalog._catalog)
+        return _catalog
 
     def __call__(self, domain=None, language=None):
 



Repository: plone.session


Branch: refs/heads/master
Date: 2018-01-25T19:07:27+01:00
Author: Max Jakob (vincero) <max.jakob@ifi.lmu.de>
Commit: https://github.com/plone/plone.session/commit/f39168435400d5aeb8a2ef5fbca734f6f5f6baa9

Add Python 2 / 3 compatibility

Files changed:
M CHANGES.rst
M plone/session/tests/testPAS.py
M plone/session/tktauth.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 19b705e..e995b2a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,9 @@ Bug fixes:
   The Plone Security Team follows the BSI and recommends administrators to change the setting in their existing Plone sites.
   [jensens]
 
+- Add Python 2 / 3 compatibility
+  [vincero]
+
 
 3.6.1 (2016-12-02)
 ------------------
diff --git a/plone/session/tests/testPAS.py b/plone/session/tests/testPAS.py
index 9b7dc5d..6a25e9d 100644
--- a/plone/session/tests/testPAS.py
+++ b/plone/session/tests/testPAS.py
@@ -4,6 +4,8 @@
 from plone.session.interfaces import ISessionPlugin
 from plone.session.tests.sessioncase import FunctionalPloneSessionTestCase
 
+import six
+
 
 class MockResponse(object):
 
@@ -101,7 +103,7 @@ def testRefresh(self):
                 None)
 
     def testUnicodeUserid(self):
-        unicode_userid = unicode(self.userid)
+        unicode_userid = six.text_type(self.userid)
         response = MockResponse()
         session = self.folder.pas.session
         # This step would fail.
diff --git a/plone/session/tktauth.py b/plone/session/tktauth.py
index 0dd51bd..6e7a5f5 100755
--- a/plone/session/tktauth.py
+++ b/plone/session/tktauth.py
@@ -58,7 +58,7 @@
   >>> import Cookie, binascii
   >>> cookie = Cookie.SimpleCookie()
   >>> cookie['auth_tkt'] = binascii.b2a_base64(tkt).strip()
-  >>> print cookie
+  >>> print(cookie)
   Set-Cookie: auth_tkt=YzdjNzMwMGFjNWNmNTI5NjU2NDQ0MTIzYWNhMzQ1Mjk0ODg1YWZh...
 
 
@@ -71,7 +71,7 @@
   >>> tkt
   'c7c7300ac5cf529656444123aca345294885afa0jbloggs!'
 
-Splitting the data reveals the contents (note the unicode output):
+Splitting the data reveals the contents (note the six.text_type output):
 
   >>> splitTicket(tkt)
   ('c7c7300ac5cf529656444123aca34529', 'jbloggs', (), '', 1216720800)
@@ -111,7 +111,7 @@
   >>> tkt
   'eea3630e98177bdbf0e7f803e1632b7e4885afa0jbloggs!foo,bar!Joe Bloggs'
   >>> cookie['auth_tkt'] = binascii.b2a_base64(tkt).strip()
-  >>> print cookie
+  >>> print(cookie)
   Set-Cookie: auth_tkt=ZWVhMzYzMGU5ODE3N2JkYmYwZTdmODAzZTE2MzJiN2U0ODg1YWZh...
   >>> data = validateTicket(
   ...     SECRET, tkt, timeout=TIMEOUT, now=NOW, mod_auth_tkt=True
@@ -138,12 +138,13 @@
 from struct import pack
 import hashlib
 import hmac
+import six
 import time
 
 
 def is_equal(val1, val2):
     # constant time comparison
-    if not isinstance(val1, basestring) or not isinstance(val2, basestring):
+    if not isinstance(val1, six.string_types) or not isinstance(val2, six.string_types):
         return False
     if len(val1) != len(val2):
         return False
diff --git a/setup.py b/setup.py
index 7b39a36..e5cf47f 100644
--- a/setup.py
+++ b/setup.py
@@ -44,6 +44,7 @@
       'plone.protect',
       'Products.PluggableAuthService',
       'setuptools',
+      'six',
       'zope.component',
       'zope.interface',
       'Zope2',


Repository: plone.session


Branch: refs/heads/master
Date: 2018-01-28T12:14:25+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.session/commit/3392fbd0bc2242aaedb9c5b9d71dd409a55b1b5e

Merge pull request #10 from plone/python3

Add Python 2 / 3 compatibility

Files changed:
M CHANGES.rst
M plone/session/tests/testPAS.py
M plone/session/tktauth.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 19b705e..e995b2a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -23,6 +23,9 @@ Bug fixes:
   The Plone Security Team follows the BSI and recommends administrators to change the setting in their existing Plone sites.
   [jensens]
 
+- Add Python 2 / 3 compatibility
+  [vincero]
+
 
 3.6.1 (2016-12-02)
 ------------------
diff --git a/plone/session/tests/testPAS.py b/plone/session/tests/testPAS.py
index 9b7dc5d..6a25e9d 100644
--- a/plone/session/tests/testPAS.py
+++ b/plone/session/tests/testPAS.py
@@ -4,6 +4,8 @@
 from plone.session.interfaces import ISessionPlugin
 from plone.session.tests.sessioncase import FunctionalPloneSessionTestCase
 
+import six
+
 
 class MockResponse(object):
 
@@ -101,7 +103,7 @@ def testRefresh(self):
                 None)
 
     def testUnicodeUserid(self):
-        unicode_userid = unicode(self.userid)
+        unicode_userid = six.text_type(self.userid)
         response = MockResponse()
         session = self.folder.pas.session
         # This step would fail.
diff --git a/plone/session/tktauth.py b/plone/session/tktauth.py
index 0dd51bd..6e7a5f5 100755
--- a/plone/session/tktauth.py
+++ b/plone/session/tktauth.py
@@ -58,7 +58,7 @@
   >>> import Cookie, binascii
   >>> cookie = Cookie.SimpleCookie()
   >>> cookie['auth_tkt'] = binascii.b2a_base64(tkt).strip()
-  >>> print cookie
+  >>> print(cookie)
   Set-Cookie: auth_tkt=YzdjNzMwMGFjNWNmNTI5NjU2NDQ0MTIzYWNhMzQ1Mjk0ODg1YWZh...
 
 
@@ -71,7 +71,7 @@
   >>> tkt
   'c7c7300ac5cf529656444123aca345294885afa0jbloggs!'
 
-Splitting the data reveals the contents (note the unicode output):
+Splitting the data reveals the contents (note the six.text_type output):
 
   >>> splitTicket(tkt)
   ('c7c7300ac5cf529656444123aca34529', 'jbloggs', (), '', 1216720800)
@@ -111,7 +111,7 @@
   >>> tkt
   'eea3630e98177bdbf0e7f803e1632b7e4885afa0jbloggs!foo,bar!Joe Bloggs'
   >>> cookie['auth_tkt'] = binascii.b2a_base64(tkt).strip()
-  >>> print cookie
+  >>> print(cookie)
   Set-Cookie: auth_tkt=ZWVhMzYzMGU5ODE3N2JkYmYwZTdmODAzZTE2MzJiN2U0ODg1YWZh...
   >>> data = validateTicket(
   ...     SECRET, tkt, timeout=TIMEOUT, now=NOW, mod_auth_tkt=True
@@ -138,12 +138,13 @@
 from struct import pack
 import hashlib
 import hmac
+import six
 import time
 
 
 def is_equal(val1, val2):
     # constant time comparison
-    if not isinstance(val1, basestring) or not isinstance(val2, basestring):
+    if not isinstance(val1, six.string_types) or not isinstance(val2, six.string_types):
         return False
     if len(val1) != len(val2):
         return False
diff --git a/setup.py b/setup.py
index 7b39a36..e5cf47f 100644
--- a/setup.py
+++ b/setup.py
@@ -44,6 +44,7 @@
       'plone.protect',
       'Products.PluggableAuthService',
       'setuptools',
+      'six',
       'zope.component',
       'zope.interface',
       'Zope2',



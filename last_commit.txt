Repository: plone.versioncheck


Branch: refs/heads/master
Date: 2018-01-25T18:48:06+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.versioncheck/commit/e0467d8235e72c7a8c14faeabec0b561147a2c66

show file path in a sane way in output

Files changed:
M CHANGES.rst
M src/plone/versioncheck/parser.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 031250a..3b0849b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Fixed: Inherited extends with same name showed up as same.
+  Now show relative to basedir if possible, else full.
+  [jensens]
+
 - Fixed: Relative extends in urls were broken.
   [jensens]
 
diff --git a/src/plone/versioncheck/parser.py b/src/plone/versioncheck/parser.py
index c498826..5ec019d 100644
--- a/src/plone/versioncheck/parser.py
+++ b/src/plone/versioncheck/parser.py
@@ -78,6 +78,7 @@ def _extract_versions_section(  # NOQA: C901
             sys.stderr.write('\n  ERROR {0:d}'.format(resp.status_code))
         else:
             sys.stderr.write('\n  fresh from server')
+
     # first read own versions section
     current_version_section_name = buildout['buildout'].get(
         'versions',
@@ -95,13 +96,19 @@ def _extract_versions_section(  # NOQA: C901
             ' will be ignored.'.format(
                 gname=version_section_name,
                 nname=buildout['buildout'].get('versions')))
+
+    if filename.startswith(base_dir):
+        key_name = filename[len(base_dir) + 1:]
+    else:
+        key_name = filename
+
     if config.has_section(version_section_name):
-        version_sections[os.path.basename(filename)] = OrderedDict(
+        version_sections[key_name] = OrderedDict(
             config.items(version_section_name)
         )
         sys.stderr.write(
             '\n  {0:d} entries in versions section.'.format(
-                len(version_sections[os.path.basename(filename)])
+                len(version_sections[key_name])
             )
         )
 
@@ -109,12 +116,12 @@ def _extract_versions_section(  # NOQA: C901
     versionannotation_section_name = buildout['buildout'].get(
         'versionannotations', versionannotation_section_name)
     if config.has_section(versionannotation_section_name):
-        annotations[os.path.basename(filename)] = OrderedDict(
+        annotations[key_name] = OrderedDict(
             config.items(versionannotation_section_name)
         )
         sys.stderr.write(
             '\n  {0:d} entries in annotations section.'.format(
-                len(annotations[os.path.basename(filename)])
+                len(annotations[key_name])
             )
         )
     try:



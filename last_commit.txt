Repository: mockup


Branch: refs/heads/master
Date: 2018-01-25T12:34:38+01:00
Author: Martin Opstad Reistadbakk (martior) <martior@gmail.com>
Commit: https://github.com/plone/mockup/commit/18195cb5c1e7c3fec533f56ec9e0943bfa6fea35

Fixing problems with wrong relative date translations for norwegian sites.

Files changed:
M CHANGES.rst
M mockup/patterns/moment/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 48b38d23..34caff87 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
 
 Bug fixes:
 
+- Fixing problems with wrong relative date translations for norwegian sites.
+  [martior]
+
 - Fixed resource registry override tab's Save button being disabled
   [obct537]
 
diff --git a/mockup/patterns/moment/pattern.js b/mockup/patterns/moment/pattern.js
index a19d640c..ed5d91d3 100644
--- a/mockup/patterns/moment/pattern.js
+++ b/mockup/patterns/moment/pattern.js
@@ -87,12 +87,12 @@ define([
   'moment',
   'mockup-i18n'
 ], function($, Base, moment, i18n) {
-  'use strict';
 
   var Moment = Base.extend({
     name: 'moment',
     trigger: '.pat-moment',
     parser: 'mockup',
+    moment_i18n_map: {'no': 'nb'},  // convert Plone language codes to moment codes.
     defaults: {
       // selector of elements to format dates for
       selector: null,
@@ -109,7 +109,11 @@ define([
       if (!date || date === 'None') {
         return;
       }
-      moment.locale([(new i18n()).currentLanguage, 'en']);
+      var currentLanguage = (new i18n()).currentLanguage;
+      if (currentLanguage in self.moment_i18n_map) {
+        currentLanguage = self.moment_i18n_map[currentLanguage];
+      }
+      moment.locale([currentLanguage, 'en']);
       date = moment(date);
       if (!date.isValid()) {
         return;


Repository: mockup


Branch: refs/heads/master
Date: 2018-01-25T12:43:00+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/0bf0375abc2b9bc4bc58716efbf5e5d8507f9cbd

Merge pull request #828 from plone/ther-martior-moment

Fixing problems with wrong relative date translations for norwegian sites

Files changed:
M CHANGES.rst
M mockup/patterns/moment/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 48b38d23..34caff87 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
 
 Bug fixes:
 
+- Fixing problems with wrong relative date translations for norwegian sites.
+  [martior]
+
 - Fixed resource registry override tab's Save button being disabled
   [obct537]
 
diff --git a/mockup/patterns/moment/pattern.js b/mockup/patterns/moment/pattern.js
index a19d640c..ed5d91d3 100644
--- a/mockup/patterns/moment/pattern.js
+++ b/mockup/patterns/moment/pattern.js
@@ -87,12 +87,12 @@ define([
   'moment',
   'mockup-i18n'
 ], function($, Base, moment, i18n) {
-  'use strict';
 
   var Moment = Base.extend({
     name: 'moment',
     trigger: '.pat-moment',
     parser: 'mockup',
+    moment_i18n_map: {'no': 'nb'},  // convert Plone language codes to moment codes.
     defaults: {
       // selector of elements to format dates for
       selector: null,
@@ -109,7 +109,11 @@ define([
       if (!date || date === 'None') {
         return;
       }
-      moment.locale([(new i18n()).currentLanguage, 'en']);
+      var currentLanguage = (new i18n()).currentLanguage;
+      if (currentLanguage in self.moment_i18n_map) {
+        currentLanguage = self.moment_i18n_map[currentLanguage];
+      }
+      moment.locale([currentLanguage, 'en']);
       date = moment(date);
       if (!date.isValid()) {
         return;



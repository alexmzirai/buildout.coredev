Repository: plone.resource


Branch: refs/heads/master
Date: 2018-01-27T14:21:31+01:00
Author: Georg GOgo. BERNHARD (gogobd) <gogo@bluedynamics.com>
Commit: https://github.com/plone/plone.resource/commit/37ab077a9c6550f9f1cdc0b49f2f03a747413d65

Add Python 2 / 3 compatibility

Files changed:
M CHANGES.rst
M plone/resource/directory.py
M plone/resource/download.py
M plone/resource/manifest.py
M plone/resource/tests/test_zcml.py
M plone/resource/tests/test_zip_download.py
M plone/resource/traversal.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 963992d..6414473 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,7 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Add python 2 / 3 compatibility
 
 Bug fixes:
 
diff --git a/plone/resource/directory.py b/plone/resource/directory.py
index f62c3b4..c1a59a2 100644
--- a/plone/resource/directory.py
+++ b/plone/resource/directory.py
@@ -1,23 +1,24 @@
 # -*- coding: utf-8 -*-
+import os.path
+import re
+import zipfile
+
+import six
 from Acquisition import aq_base, aq_parent
 from OFS.Image import File
 from OFS.interfaces import IObjectManager
-from plone.resource.events import PloneResourceCreatedEvent
-from plone.resource.events import PloneResourceModifiedEvent
+from plone.resource.events import (PloneResourceCreatedEvent,
+                                   PloneResourceModifiedEvent)
 from plone.resource.file import FilesystemFile
-from plone.resource.interfaces import IResourceDirectory
-from plone.resource.interfaces import IWritableResourceDirectory
+from plone.resource.interfaces import (IResourceDirectory,
+                                       IWritableResourceDirectory)
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
 from Products.CMFCore.utils import getToolByName
-from StringIO import StringIO
-from zExceptions import Forbidden
-from zExceptions import NotFound
+from six import StringIO
+from zExceptions import Forbidden, NotFound
 from zope.event import notify
 from zope.interface import implementer
 from zope.site.hooks import getSite
-import os.path
-import re
-import zipfile
 
 # filter dot files, Mac resource forks
 FILTERS = (r'\..*', '__MACOSX')
@@ -46,7 +47,7 @@ def __repr__(self):
                                       '/'.join(self.context.getPhysicalPath()))
 
     def publishTraverse(self, request, name):
-        if isinstance(name, unicode):
+        if isinstance(name, six.text_type):
             name = name.encode('utf-8')
 
         context = self.context
@@ -70,7 +71,7 @@ def __getitem__(self, name):
         return self.publishTraverse(None, name)
 
     def __setitem__(self, name, item):
-        if isinstance(name, unicode):
+        if isinstance(name, six.text_type):
             name = name.encode('utf-8')
 
         if IResourceDirectory.providedBy(item):
@@ -142,7 +143,7 @@ def makeDirectory(self, path):
         names = path.strip('/').split('/')
         for name in names:
             if name not in parent:
-                if isinstance(name, unicode):
+                if isinstance(name, six.text_type):
                     name = name.encode('utf-8')
                 f = BTreeFolder2(name)
                 parent._setOb(name, f)
@@ -153,7 +154,7 @@ def writeFile(self, path, data):
         if basepath:
             self.makeDirectory(basepath)
         filename = path.split('/')[-1]
-        if isinstance(filename, unicode):
+        if isinstance(filename, six.text_type):
             filename = filename.encode('utf-8')
         f = File(filename, filename, data)
         ct = f.getContentType()
diff --git a/plone/resource/download.py b/plone/resource/download.py
index 2fd7474..f5c255d 100644
--- a/plone/resource/download.py
+++ b/plone/resource/download.py
@@ -1,5 +1,5 @@
 # -*- coding: utf-8 -*-
-from StringIO import StringIO
+from six import StringIO
 from zope.publisher.browser import BrowserView
 
 
diff --git a/plone/resource/manifest.py b/plone/resource/manifest.py
index 84eb6e8..50caf11 100644
--- a/plone/resource/manifest.py
+++ b/plone/resource/manifest.py
@@ -28,12 +28,13 @@
 ``bar``. ``title`` and ``description`` will be ``None`` if not found in the
 manifest. ``bar`` will be ``baz`` if not found.
 """
-from ConfigParser import SafeConfigParser
+import logging
+
 from plone.resource.directory import FILTERS
 from plone.resource.interfaces import IResourceDirectory
 from plone.resource.utils import iterDirectoriesOfType
+from six.moves.configparser import SafeConfigParser
 from zope.component import getUtility
-import logging
 
 MANIFEST_FILENAME = 'manifest.cfg'
 
diff --git a/plone/resource/tests/test_zcml.py b/plone/resource/tests/test_zcml.py
index e49845a..6d5043e 100644
--- a/plone/resource/tests/test_zcml.py
+++ b/plone/resource/tests/test_zcml.py
@@ -1,14 +1,13 @@
 # -*- coding: utf-8 -*-
+import os.path
+import unittest
+
 from plone.resource.interfaces import IResourceDirectory
-from StringIO import StringIO
+from six import StringIO
 from zope.component import getUtility
 from zope.component.testing import tearDown
 from zope.configuration.exceptions import ConfigurationError
-from zope.configuration.xmlconfig import xmlconfig
-from zope.configuration.xmlconfig import XMLConfig
-
-import os.path
-import unittest
+from zope.configuration.xmlconfig import XMLConfig, xmlconfig
 
 
 def clearZCML(test=None):
diff --git a/plone/resource/tests/test_zip_download.py b/plone/resource/tests/test_zip_download.py
index ea97b50..5c1090b 100644
--- a/plone/resource/tests/test_zip_download.py
+++ b/plone/resource/tests/test_zip_download.py
@@ -1,19 +1,18 @@
 # -*- coding: utf-8 -*-
+import os.path
+import unittest
+import zipfile
+
 from OFS.Image import File
-from plone.resource.directory import FilesystemResourceDirectory
-from plone.resource.directory import PersistentResourceDirectory
+from plone.resource.directory import (FilesystemResourceDirectory,
+                                      PersistentResourceDirectory)
 from plone.resource.interfaces import IResourceDirectory
 from plone.resource.testing import DEMO_TRAVERSER_INTEGRATION_TESTING
 from plone.testing import zca
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
-from StringIO import StringIO
+from six import StringIO
 from zope.component import provideUtility
 
-import os.path
-import unittest
-import zipfile
-
-
 base_path = os.path.dirname(__file__)
 test_dir_path = os.path.join(base_path, 'resources')
 
diff --git a/plone/resource/traversal.py b/plone/resource/traversal.py
index eb0ce03..ae99554 100644
--- a/plone/resource/traversal.py
+++ b/plone/resource/traversal.py
@@ -1,10 +1,10 @@
 # -*- coding: utf-8 -*-
 from plone.resource.interfaces import IUniqueResourceRequest
 from plone.resource.utils import queryResourceDirectory
+from six.moves import urllib
 from zExceptions import NotFound
 from zope.interface import alsoProvides
 from zope.traversing.namespace import SimpleHandler
-import urllib
 
 
 class ResourceTraverser(SimpleHandler):
@@ -18,7 +18,7 @@ def traverse(self, name, remaining):
         _type = self.name
 
         # Note: also fixes possible unicode problems
-        name = urllib.quote(name)
+        name = urllib.parse.quote(name)
 
         res = queryResourceDirectory(_type, name)
         if res is not None:
diff --git a/setup.py b/setup.py
index 2ea03af..641445d 100644
--- a/setup.py
+++ b/setup.py
@@ -49,6 +49,7 @@
         'zope.schema',
         'zope.traversing',
         'Zope2',
+        'six',
     ],
     extras_require={
         'test': test_requires,


Repository: plone.resource


Branch: refs/heads/master
Date: 2018-01-27T20:40:12+01:00
Author: Georg GOgo. BERNHARD (gogobd) <gogo@bluedynamics.com>
Commit: https://github.com/plone/plone.resource/commit/de28ea3c601b3d729e3281df61946ff09fe81d0d

Using Plones recommended .isort.cfg

Files changed:
M plone/resource/directory.py
M plone/resource/manifest.py
M plone/resource/tests/test_zip_download.py

diff --git a/plone/resource/directory.py b/plone/resource/directory.py
index c1a59a2..6cf660f 100644
--- a/plone/resource/directory.py
+++ b/plone/resource/directory.py
@@ -4,22 +4,25 @@
 import zipfile
 
 import six
-from Acquisition import aq_base, aq_parent
+from Acquisition import aq_base
+from Acquisition import aq_parent
 from OFS.Image import File
 from OFS.interfaces import IObjectManager
-from plone.resource.events import (PloneResourceCreatedEvent,
-                                   PloneResourceModifiedEvent)
+from plone.resource.events import PloneResourceCreatedEvent
+from plone.resource.events import PloneResourceModifiedEvent
 from plone.resource.file import FilesystemFile
-from plone.resource.interfaces import (IResourceDirectory,
-                                       IWritableResourceDirectory)
+from plone.resource.interfaces import IResourceDirectory
+from plone.resource.interfaces import IWritableResourceDirectory
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
 from Products.CMFCore.utils import getToolByName
 from six import StringIO
-from zExceptions import Forbidden, NotFound
+from zExceptions import Forbidden
+from zExceptions import NotFound
 from zope.event import notify
 from zope.interface import implementer
 from zope.site.hooks import getSite
 
+
 # filter dot files, Mac resource forks
 FILTERS = (r'\..*', '__MACOSX')
 FILTERS = [re.compile(pattern) for pattern in FILTERS]
diff --git a/plone/resource/manifest.py b/plone/resource/manifest.py
index 50caf11..9211a5e 100644
--- a/plone/resource/manifest.py
+++ b/plone/resource/manifest.py
@@ -36,6 +36,7 @@
 from six.moves.configparser import SafeConfigParser
 from zope.component import getUtility
 
+
 MANIFEST_FILENAME = 'manifest.cfg'
 
 LOGGER = logging.getLogger('plone.resource.manifest')
diff --git a/plone/resource/tests/test_zip_download.py b/plone/resource/tests/test_zip_download.py
index 5c1090b..cb5b9e6 100644
--- a/plone/resource/tests/test_zip_download.py
+++ b/plone/resource/tests/test_zip_download.py
@@ -4,8 +4,8 @@
 import zipfile
 
 from OFS.Image import File
-from plone.resource.directory import (FilesystemResourceDirectory,
-                                      PersistentResourceDirectory)
+from plone.resource.directory import FilesystemResourceDirectory
+from plone.resource.directory import PersistentResourceDirectory
 from plone.resource.interfaces import IResourceDirectory
 from plone.resource.testing import DEMO_TRAVERSER_INTEGRATION_TESTING
 from plone.testing import zca
@@ -13,6 +13,7 @@
 from six import StringIO
 from zope.component import provideUtility
 
+
 base_path = os.path.dirname(__file__)
 test_dir_path = os.path.join(base_path, 'resources')
 


Repository: plone.resource


Branch: refs/heads/master
Date: 2018-01-28T14:38:51+01:00
Author: Georg Gogo. BERNHARD (gogobd) <gogo@bluedynamics.com>
Commit: https://github.com/plone/plone.resource/commit/d410076815b15a215defed950ca36dada32ebaf6

Merge pull request #22 from plone/Python3

Prepare Python 2 / 3 compatibility

Files changed:
M CHANGES.rst
M plone/resource/directory.py
M plone/resource/download.py
M plone/resource/manifest.py
M plone/resource/tests/test_zcml.py
M plone/resource/tests/test_zip_download.py
M plone/resource/traversal.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 963992d..6414473 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,7 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Add python 2 / 3 compatibility
 
 Bug fixes:
 
diff --git a/plone/resource/directory.py b/plone/resource/directory.py
index f62c3b4..6cf660f 100644
--- a/plone/resource/directory.py
+++ b/plone/resource/directory.py
@@ -1,5 +1,11 @@
 # -*- coding: utf-8 -*-
-from Acquisition import aq_base, aq_parent
+import os.path
+import re
+import zipfile
+
+import six
+from Acquisition import aq_base
+from Acquisition import aq_parent
 from OFS.Image import File
 from OFS.interfaces import IObjectManager
 from plone.resource.events import PloneResourceCreatedEvent
@@ -9,15 +15,13 @@
 from plone.resource.interfaces import IWritableResourceDirectory
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
 from Products.CMFCore.utils import getToolByName
-from StringIO import StringIO
+from six import StringIO
 from zExceptions import Forbidden
 from zExceptions import NotFound
 from zope.event import notify
 from zope.interface import implementer
 from zope.site.hooks import getSite
-import os.path
-import re
-import zipfile
+
 
 # filter dot files, Mac resource forks
 FILTERS = (r'\..*', '__MACOSX')
@@ -46,7 +50,7 @@ def __repr__(self):
                                       '/'.join(self.context.getPhysicalPath()))
 
     def publishTraverse(self, request, name):
-        if isinstance(name, unicode):
+        if isinstance(name, six.text_type):
             name = name.encode('utf-8')
 
         context = self.context
@@ -70,7 +74,7 @@ def __getitem__(self, name):
         return self.publishTraverse(None, name)
 
     def __setitem__(self, name, item):
-        if isinstance(name, unicode):
+        if isinstance(name, six.text_type):
             name = name.encode('utf-8')
 
         if IResourceDirectory.providedBy(item):
@@ -142,7 +146,7 @@ def makeDirectory(self, path):
         names = path.strip('/').split('/')
         for name in names:
             if name not in parent:
-                if isinstance(name, unicode):
+                if isinstance(name, six.text_type):
                     name = name.encode('utf-8')
                 f = BTreeFolder2(name)
                 parent._setOb(name, f)
@@ -153,7 +157,7 @@ def writeFile(self, path, data):
         if basepath:
             self.makeDirectory(basepath)
         filename = path.split('/')[-1]
-        if isinstance(filename, unicode):
+        if isinstance(filename, six.text_type):
             filename = filename.encode('utf-8')
         f = File(filename, filename, data)
         ct = f.getContentType()
diff --git a/plone/resource/download.py b/plone/resource/download.py
index 2fd7474..f5c255d 100644
--- a/plone/resource/download.py
+++ b/plone/resource/download.py
@@ -1,5 +1,5 @@
 # -*- coding: utf-8 -*-
-from StringIO import StringIO
+from six import StringIO
 from zope.publisher.browser import BrowserView
 
 
diff --git a/plone/resource/manifest.py b/plone/resource/manifest.py
index 84eb6e8..9211a5e 100644
--- a/plone/resource/manifest.py
+++ b/plone/resource/manifest.py
@@ -28,12 +28,14 @@
 ``bar``. ``title`` and ``description`` will be ``None`` if not found in the
 manifest. ``bar`` will be ``baz`` if not found.
 """
-from ConfigParser import SafeConfigParser
+import logging
+
 from plone.resource.directory import FILTERS
 from plone.resource.interfaces import IResourceDirectory
 from plone.resource.utils import iterDirectoriesOfType
+from six.moves.configparser import SafeConfigParser
 from zope.component import getUtility
-import logging
+
 
 MANIFEST_FILENAME = 'manifest.cfg'
 
diff --git a/plone/resource/tests/test_zcml.py b/plone/resource/tests/test_zcml.py
index e49845a..6d5043e 100644
--- a/plone/resource/tests/test_zcml.py
+++ b/plone/resource/tests/test_zcml.py
@@ -1,14 +1,13 @@
 # -*- coding: utf-8 -*-
+import os.path
+import unittest
+
 from plone.resource.interfaces import IResourceDirectory
-from StringIO import StringIO
+from six import StringIO
 from zope.component import getUtility
 from zope.component.testing import tearDown
 from zope.configuration.exceptions import ConfigurationError
-from zope.configuration.xmlconfig import xmlconfig
-from zope.configuration.xmlconfig import XMLConfig
-
-import os.path
-import unittest
+from zope.configuration.xmlconfig import XMLConfig, xmlconfig
 
 
 def clearZCML(test=None):
diff --git a/plone/resource/tests/test_zip_download.py b/plone/resource/tests/test_zip_download.py
index ea97b50..cb5b9e6 100644
--- a/plone/resource/tests/test_zip_download.py
+++ b/plone/resource/tests/test_zip_download.py
@@ -1,4 +1,8 @@
 # -*- coding: utf-8 -*-
+import os.path
+import unittest
+import zipfile
+
 from OFS.Image import File
 from plone.resource.directory import FilesystemResourceDirectory
 from plone.resource.directory import PersistentResourceDirectory
@@ -6,13 +10,9 @@
 from plone.resource.testing import DEMO_TRAVERSER_INTEGRATION_TESTING
 from plone.testing import zca
 from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2
-from StringIO import StringIO
+from six import StringIO
 from zope.component import provideUtility
 
-import os.path
-import unittest
-import zipfile
-
 
 base_path = os.path.dirname(__file__)
 test_dir_path = os.path.join(base_path, 'resources')
diff --git a/plone/resource/traversal.py b/plone/resource/traversal.py
index eb0ce03..ae99554 100644
--- a/plone/resource/traversal.py
+++ b/plone/resource/traversal.py
@@ -1,10 +1,10 @@
 # -*- coding: utf-8 -*-
 from plone.resource.interfaces import IUniqueResourceRequest
 from plone.resource.utils import queryResourceDirectory
+from six.moves import urllib
 from zExceptions import NotFound
 from zope.interface import alsoProvides
 from zope.traversing.namespace import SimpleHandler
-import urllib
 
 
 class ResourceTraverser(SimpleHandler):
@@ -18,7 +18,7 @@ def traverse(self, name, remaining):
         _type = self.name
 
         # Note: also fixes possible unicode problems
-        name = urllib.quote(name)
+        name = urllib.parse.quote(name)
 
         res = queryResourceDirectory(_type, name)
         if res is not None:
diff --git a/setup.py b/setup.py
index 2ea03af..641445d 100644
--- a/setup.py
+++ b/setup.py
@@ -49,6 +49,7 @@
         'zope.schema',
         'zope.traversing',
         'Zope2',
+        'six',
     ],
     extras_require={
         'test': test_requires,



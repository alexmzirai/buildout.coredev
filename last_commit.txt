Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2018-01-28T12:02:22+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/c18d3d91fe07851e54b401f149a96f50615d980a

Imports are Python3 compatible

Files changed:
M CHANGES.rst
M plone/formwidget/namedfile/widget.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index db1472e..40247ff 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -22,6 +22,8 @@ Bug fixes:
 
 Bug fixes:
 
+- Imports are Python3 compatible
+  [ale-rt]
 - remove mention of "retina" (https://github.com/plone/Products.CMFPlone/issues/2123)
   [tkimnguyen]
 
diff --git a/plone/formwidget/namedfile/widget.py b/plone/formwidget/namedfile/widget.py
index bbf9043..c3b75d4 100644
--- a/plone/formwidget/namedfile/widget.py
+++ b/plone/formwidget/namedfile/widget.py
@@ -16,6 +16,7 @@
 from Products.CMFCore.utils import getToolByName
 from Products.Five.browser import BrowserView
 from Products.MimetypesRegistry.common import MimeTypeException
+from six.moves import urllib
 from z3c.form.browser import file
 from z3c.form.group import Group
 from z3c.form.interfaces import IDataManager
@@ -28,14 +29,13 @@
 from zope.component import getMultiAdapter
 from zope.component.hooks import getSite
 from zope.interface import implementer
-from zope.interface import implementer
 from zope.interface import implementer_only
 from zope.publisher.interfaces import IPublishTraverse
 from zope.publisher.interfaces import NotFound
 from zope.schema.interfaces import IASCII
 from zope.size import byteDisplay
 from ZPublisher.HTTPRequest import FileUpload
-import urllib
+
 
 try:
     from os import SEEK_END
@@ -137,7 +137,7 @@ def filename_encoded(self):
         else:
             if isinstance(filename, unicode):
                 filename = filename.encode('utf-8')
-            return urllib.quote_plus(filename)
+            return urllib.parse.quote_plus(filename)
 
     @property
     def download_url(self):
diff --git a/setup.py b/setup.py
index e5d3e4b..22cf6e9 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
-from setuptools import setup
 from setuptools import find_packages
+from setuptools import setup
+
 
 version = '2.0.6.dev0'
 
@@ -30,6 +31,7 @@
         'setuptools',
         'plone.namedfile',
         'plone.z3cform >= 0.7.4',
+        'six',
         'z3c.form',
     ],
     extras_require={


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2018-01-28T12:02:22+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/d84015ecb66a0f79db75a8424b511ac23ad3919a

some more py changes

Files changed:
M plone/formwidget/namedfile/converter.py
M plone/formwidget/namedfile/widget.py

diff --git a/plone/formwidget/namedfile/converter.py b/plone/formwidget/namedfile/converter.py
index 66b89a3..0325160 100644
--- a/plone/formwidget/namedfile/converter.py
+++ b/plone/formwidget/namedfile/converter.py
@@ -10,7 +10,9 @@
 from zope.component import adapts
 from zope.schema.interfaces import IASCII
 from ZPublisher.HTTPRequest import FileUpload
+
 import base64
+import six
 
 
 class NamedDataConverter(BaseDataConverter):
@@ -32,7 +34,8 @@ def toFieldValue(self, value):
 
             filename = safe_basename(value.filename)
 
-            if filename is not None and not isinstance(filename, unicode):
+            if filename is not None and not isinstance(
+                    filename, six.text_type):
                 # Work-around for
                 # https://bugs.launchpad.net/zope2/+bug/499696
                 filename = filename.decode('utf-8')
@@ -45,7 +48,7 @@ def toFieldValue(self, value):
                 return self.field.missing_value
 
         else:
-            if isinstance(value, unicode):
+            if isinstance(value, six.text_type):
                 value = value.encode('utf-8')
             return self.field._type(data=str(value))
 
@@ -53,7 +56,7 @@ def toFieldValue(self, value):
 def b64encode_file(filename, data):
     # encode filename and data using the standard alphabet, so that ";" can be
     # used as delimiter.
-    if isinstance(filename, unicode):
+    if isinstance(filename, six.text_type):
         filename = filename.encode('utf-8')
     filenameb64 = base64.standard_b64encode(filename or '')
     datab64 = base64.standard_b64encode(data)
@@ -84,7 +87,7 @@ class Base64Converter(BaseDataConverter):
 
     def toWidgetValue(self, value):
 
-        if not isinstance(value, basestring):
+        if not isinstance(value, six.string_types):
             return None
 
         filename, data = b64decode_file(value)
diff --git a/plone/formwidget/namedfile/widget.py b/plone/formwidget/namedfile/widget.py
index c3b75d4..13f2920 100644
--- a/plone/formwidget/namedfile/widget.py
+++ b/plone/formwidget/namedfile/widget.py
@@ -36,6 +36,7 @@
 from zope.size import byteDisplay
 from ZPublisher.HTTPRequest import FileUpload
 
+import six
 
 try:
     from os import SEEK_END
@@ -47,7 +48,7 @@ def _make_namedfile(value, field, widget):
     """Return a NamedImage or NamedFile instance, if it isn't already one -
     e.g. when it's base64 encoded data.
     """
-    if isinstance(value, basestring) and IASCII.providedBy(field):
+    if isinstance(value, six.string_types) and IASCII.providedBy(field):
         filename, data = b64decode_file(value)
         if INamedImageWidget.providedBy(widget):
             value = NamedImage(data=data, filename=filename)
@@ -135,7 +136,7 @@ def filename_encoded(self):
         if filename is None:
             return None
         else:
-            if isinstance(filename, unicode):
+            if isinstance(filename, six.text_type):
                 filename = filename.encode('utf-8')
             return urllib.parse.quote_plus(filename)
 


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2018-01-28T12:02:22+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/10766ee5023779728424d3bb474698c3c045d572

wording

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 40247ff..86ae556 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -22,8 +22,9 @@ Bug fixes:
 
 Bug fixes:
 
-- Imports are Python3 compatible
-  [ale-rt]
+- Prepare for Python 2 / 3 compatibility
+  [ale-rt, pbauer]
+
 - remove mention of "retina" (https://github.com/plone/Products.CMFPlone/issues/2123)
   [tkimnguyen]
 


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2018-01-28T12:03:00+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/398207c1f0aa537341a9adb6a2b167706d52f9fb

fix changenote after rebase

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 86ae556..ab2642d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Prepare for Python 2 / 3 compatibility
+  [ale-rt, pbauer]
 
 
 2.0.5 (2017-11-26)
@@ -22,9 +23,6 @@ Bug fixes:
 
 Bug fixes:
 
-- Prepare for Python 2 / 3 compatibility
-  [ale-rt, pbauer]
-
 - remove mention of "retina" (https://github.com/plone/Products.CMFPlone/issues/2123)
   [tkimnguyen]
 


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2018-02-06T10:56:58+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/76bd24d52ee55086d2218ccf2afec99d73cdb246

Merge pull request #30 from plone/py3_imports

Prepare for Python 2 / 3 compatibility

Files changed:
M CHANGES.rst
M plone/formwidget/namedfile/converter.py
M plone/formwidget/namedfile/widget.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index db1472e..ab2642d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Prepare for Python 2 / 3 compatibility
+  [ale-rt, pbauer]
 
 
 2.0.5 (2017-11-26)
diff --git a/plone/formwidget/namedfile/converter.py b/plone/formwidget/namedfile/converter.py
index 66b89a3..0325160 100644
--- a/plone/formwidget/namedfile/converter.py
+++ b/plone/formwidget/namedfile/converter.py
@@ -10,7 +10,9 @@
 from zope.component import adapts
 from zope.schema.interfaces import IASCII
 from ZPublisher.HTTPRequest import FileUpload
+
 import base64
+import six
 
 
 class NamedDataConverter(BaseDataConverter):
@@ -32,7 +34,8 @@ def toFieldValue(self, value):
 
             filename = safe_basename(value.filename)
 
-            if filename is not None and not isinstance(filename, unicode):
+            if filename is not None and not isinstance(
+                    filename, six.text_type):
                 # Work-around for
                 # https://bugs.launchpad.net/zope2/+bug/499696
                 filename = filename.decode('utf-8')
@@ -45,7 +48,7 @@ def toFieldValue(self, value):
                 return self.field.missing_value
 
         else:
-            if isinstance(value, unicode):
+            if isinstance(value, six.text_type):
                 value = value.encode('utf-8')
             return self.field._type(data=str(value))
 
@@ -53,7 +56,7 @@ def toFieldValue(self, value):
 def b64encode_file(filename, data):
     # encode filename and data using the standard alphabet, so that ";" can be
     # used as delimiter.
-    if isinstance(filename, unicode):
+    if isinstance(filename, six.text_type):
         filename = filename.encode('utf-8')
     filenameb64 = base64.standard_b64encode(filename or '')
     datab64 = base64.standard_b64encode(data)
@@ -84,7 +87,7 @@ class Base64Converter(BaseDataConverter):
 
     def toWidgetValue(self, value):
 
-        if not isinstance(value, basestring):
+        if not isinstance(value, six.string_types):
             return None
 
         filename, data = b64decode_file(value)
diff --git a/plone/formwidget/namedfile/widget.py b/plone/formwidget/namedfile/widget.py
index bbf9043..13f2920 100644
--- a/plone/formwidget/namedfile/widget.py
+++ b/plone/formwidget/namedfile/widget.py
@@ -16,6 +16,7 @@
 from Products.CMFCore.utils import getToolByName
 from Products.Five.browser import BrowserView
 from Products.MimetypesRegistry.common import MimeTypeException
+from six.moves import urllib
 from z3c.form.browser import file
 from z3c.form.group import Group
 from z3c.form.interfaces import IDataManager
@@ -28,14 +29,14 @@
 from zope.component import getMultiAdapter
 from zope.component.hooks import getSite
 from zope.interface import implementer
-from zope.interface import implementer
 from zope.interface import implementer_only
 from zope.publisher.interfaces import IPublishTraverse
 from zope.publisher.interfaces import NotFound
 from zope.schema.interfaces import IASCII
 from zope.size import byteDisplay
 from ZPublisher.HTTPRequest import FileUpload
-import urllib
+
+import six
 
 try:
     from os import SEEK_END
@@ -47,7 +48,7 @@ def _make_namedfile(value, field, widget):
     """Return a NamedImage or NamedFile instance, if it isn't already one -
     e.g. when it's base64 encoded data.
     """
-    if isinstance(value, basestring) and IASCII.providedBy(field):
+    if isinstance(value, six.string_types) and IASCII.providedBy(field):
         filename, data = b64decode_file(value)
         if INamedImageWidget.providedBy(widget):
             value = NamedImage(data=data, filename=filename)
@@ -135,9 +136,9 @@ def filename_encoded(self):
         if filename is None:
             return None
         else:
-            if isinstance(filename, unicode):
+            if isinstance(filename, six.text_type):
                 filename = filename.encode('utf-8')
-            return urllib.quote_plus(filename)
+            return urllib.parse.quote_plus(filename)
 
     @property
     def download_url(self):
diff --git a/setup.py b/setup.py
index ac41fa8..cddddbe 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
-from setuptools import setup
 from setuptools import find_packages
+from setuptools import setup
+
 
 version = '2.0.6.dev0'
 
@@ -31,6 +32,7 @@
         'setuptools',
         'plone.namedfile',
         'plone.z3cform >= 0.7.4',
+        'six',
         'z3c.form',
     ],
     extras_require={


